<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        div {
            position: relative;
            left: 0;
            top: 0;
            width: 50px;
            height: 50px;
            background-color: red;
        }

        input {
            position: absolute;
            left: 0;
            top: 0;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="dv"></div>
    <input type="button" value="点击400px" id="btn">
    <script src="../common.js"></script>
    <script>
        my$("btn").onclick = function () {
            var json = {
                "left": 200,
                "height": 200,
                "width": 200,
                "zIndex": 1, //层级
                "opacity": 0.2, //透明度
            };
            animate(my$("dv"), json, 20, function () {
                var json1 = {
                    "left": 0,
                    "height": 200,
                    "width": 200,
                    "zIndex": 1000, //层级
                    "opacity": 1, //透明度
                };
                animate(my$("dv"), json1, 20, function () {
                    var json3 = {
                        "left": 500,
                        "height": 200,
                        "width": 200,
                        "zIndex": 1000, //层级
                        "opacity": 0.4, //透明度
                    };
                    animate(my$("dv"), json3, 20);
                });
            });
        }

        // 动画函数
        function animate(element, json, time, fn) {
            //每点击一次按钮都要先清理一次定时器(不管有没有)
            clearInterval(element.timeId);
            //定时器的一个id值存储到了对象的一个属性中
            element.timeId = setInterval(function () {
                var flag = true; //默认,假设,全部到达目标
                for (var attr in json) {
                    if (attr == "zIndex") { //判断attr是不是zIndex
                        element.style[attr] = json[attr];
                    } else if (attr == "opacity") { //判断attr是不是opacity
                        //获取元素当前的透明度,放大100倍,方便计算
                        var current = getStyle(element, attr) * 100;
                        //当前的对象对应的属性的属性值,不能用点的方法,也放大一百倍
                        var target = json[attr] * 100;
                        //每次移动的距离
                        var temp = (target - current) / 10;
                        temp = temp > 0 ? Math.ceil(temp) : Math.floor(temp);
                        current += temp;//移动后的值
                        element.style[attr] = current / 100;
                    } else { //普通属性
                        //获取元素当前的位置
                        var current = parseInt(getStyle(element, attr));
                        //当前的对象对应的属性的属性值,不能用点的方法
                        var target = json[attr];
                        //每次移动的距离
                        var temp = (target - current) / 10;
                        temp = temp > 0 ? Math.ceil(temp) : Math.floor(temp);
                        //移动到当前位置
                        current += temp;
                        element.style[attr] = current + "px";
                    }
                    if (current != target) {
                        flag = false;
                    }
                }
                //判断:如果我当前的位置距离目标位置大于我每次走的步数,我就照常走
                if (flag) {
                    clearInterval(element.timeId);
                    //所有属性到达目标才能使用这个函数,前提是用户传入了这个函数
                    //回调函数
                    if (fn) {
                        fn();
                    }
                }
                //测试代码:
                console.log("目标位置:" + target + ",当前位置:" + current + ",每次移动步数:" + temp);
            }, time);
        }

        // 计算后的样式属性-----一个元素任意的一个样式的属性值----字符串类型
        function getStyle(element, style) {
            return window.getComputedStyle ? window.getComputedStyle(element, null)[style] : element.currentStyle[style];
        }
    </script>
</body>
</html>